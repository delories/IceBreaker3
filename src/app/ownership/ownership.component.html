<head>
  <meta charset="UTF-8">
  <title>股权结构</title>
  <script src="resource/js/echarts.js"></script>
  <script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.js"></script>
</head>
<body>
<!-- 为 ECharts 准备一个具备大小（宽高）的 DOM -->
<div id="main" style="width: 1000px;height:1000px;"></div>
<script type="text/javascript">
  // 基于准备好的dom，初始化echarts实例
  alert(1);
  var myChart = echarts.init(document.getElementById('main'));

  var Data = [];      //存储待处理数据信息

  $.get('http://115.159.39.220:3444/relations/0/firm_a3ab367a90838846f859082a03730ae7.html', function (data) {
//        对获取到的数据进行预处理
    console.log(data);
    console.log(data.id);
    console.log(data.name);
    var maxValue = -1;
    var maxName;
    var thisName = data.name;
    for (var i = 0; i < data.children.length; i++) {
      if (data.children[i].value[0] === '1') {
        var reg = /\d+(\.\d+)?万元$/;
        test = data.children[i].value.match(reg);
        var newdata = {};                 //创建临时对象
        newdata.value = parseInt(test);
        newdata.name = data.children[i].name;
        //判别个人股东和企业股东
        if (data.children[i].id.search("pl") != -1) {
          newdata.name += "(自然人股东)";
        } else
          newdata.name += "(企业股东)";
        if (newdata.value > maxValue) {
          maxValue = newdata.value;
          maxName = data.children[i].name;
        }
        Data.push(newdata);
      }
    }
    console.log(Data);

    //寻找大股东
    for (var i = 0; i < Data.length; i++) {
      if (Data[i].value == maxValue) {
        Data[i].name += "(大股东)";
      }
    }


    var data = Data;

    var legend_data = [];
    for (var i = 0; i < Data.length; i++) {
      console.log(Data[i].name);
      legend_data.push(Data[i].name);
    }
    console.log(legend_data);

    // 指定图表的配置项和数据
    var option = {
      title: {
        text: '股权结构',
        subtext: thisName,
        x: 'center'
      },
      tooltip: {          //这是什么作用？
        trigger: 'item',
        formatter: "{a} <br/>{b} : {c} ({d}%)",
        axisPointer: {
          type: 'none'
        }
      },
      legend: {
        orient: 'vertical',
        x: 'left',
        data: legend_data
      },
      toolbox: {
        show: true,
        feature: {
          mark: {show: true},
          dataView: {show: true, readOnly: false},
          magicType: {
            show: true,
            type: ['pie', 'funnel'],
            option: {
              funnel: {
                x: '25%',
                width: '50%',
                funnelAlign: 'left',
                max: 1548
              }
            }
          },
          restore: {show: true},
          saveAsImage: {show: true}
        }
      },
      calculable: true,
      series: [{
        name: '股权结构',
        type: 'pie',
        radius: '55%',
        center: ['50%', '60%'],
        data: data,
        itemStyle: {
          normal: {
            label: {
              show: true,
              position: 'inner',
              formatter: '{c} ({d}%)'
            },
            labelLine: {
              show: false
            }
          }
        }

      },

      ]
    };

    // 使用刚指定的配置项和数据显示图表。
    myChart.setOption(option);

  });

</script>
</body>
